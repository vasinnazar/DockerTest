!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","free-jqgrid-plugins/ui.multiselect","jquery-ui/dialog","jquery-ui/draggable","jquery-ui/droppable","jquery-ui/resizable","jquery-ui/sortable"],function(c){return b(c,a,a.document)}):"object"==typeof module&&module.exports?module.exports=function(a,c){return a||(a=window),void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(a)),require("./grid.base"),require("free-jqgrid-plugins/ui.multiselect"),require("jquery-ui/dialog"),require("jquery-ui/draggable"),require("jquery-ui/droppable"),require("jquery-ui/resizable"),require("jquery-ui/sortable"),b(c,a,a.document),c}:b(jQuery,a,a.document)}("undefined"!=typeof window?window:this,function(a,b,c){"use strict";var d=a.jgrid,e=d.jqID,f=null!=a.ui?a.ui.multiselect:null,g=function(b){if(null!=this.grid&&null!=this.grid.p){var c,d,e,f,g,h=this,i=this.grid.p,j=this.gh,k=this.selectedList,l=this.inGroup,m=k.find("li"),n=m.length-1,o=function(b,c,d){var e,f,g=k.find("li");for(void 0===c&&(c=d?g.length-1:0),e=c;d?e>=0:e<g.length;d?e--:e++)if((f=a(g[e]).data("optionLink"))&&b.call(g[e],parseInt(f.val(),10),e))return e},p=function(){d=a.inArray(i.colModel[b].name,h.newColOrder),d>=0&&h.newColOrder.splice(d,1),m=k.find("li"),c=0,o(function(d,e){if(d===b){for(n=e;c>=0&&c<i.colModel.length&&(i.colModel[c].hidden||i.colModel[c].hidedlg)&&null!=l&&l[c]===l[b];)c++;return h.newColOrder.splice(c,0,i.colModel[b].name),!0}c=a.inArray(i.colModel[d].name,h.newColOrder,c),c<0&&(c=a.inArray(i.colModel[d].name,h.newColOrder)),c++})},q=function(c){if(l[c]===l[b])return a(this).after(m[n]),p(),!0},r=function(c){if(l[c]===l[b])return a(this).before(m[n]),p(),!0},s=function(a){if(l[a]===l[b]&&void 0!==l[a])return j[l[a]].startColumnName=i.colModel[a].name,!0};if(p(),j&&void 0!==j[l[b]]){for(f=j[l[b]],d=0;d<f.numberOfColumns;d++)if(c=i.iColByName[f.startColumnName]+d,!i.colModel[c].hidden&&!i.colModel[c].hidedlg){o(q,n-1,!0),o(r,n+1),o(s);break}}else if(j){if(m=k.find("li"),(d=o(function(a){if(a===b)return!0}))+1>=m.length||d<0)return;if((g=a(m[d+1]).data("optionLink"))&&void 0!==(e=l[parseInt(g.val(),10)])&&(g=a(m[d-1]).data("optionLink"))&&l[parseInt(g.val(),10)]===e){var t=o(function(a){if(l[a]!==e)return!0},d+1);a(m[void 0===t||t>=m.length?m.length-1:t-1]).after(m[n]),p()}}}};if(d.msie&&8===d.msiever()&&(a.expr[":"].hidden=function(a){return 0===a.offsetWidth||0===a.offsetHeight||"none"===a.style.display}),d._multiselect=!1,f){if(f.prototype._setSelected){var h=f.prototype._setSelected;f.prototype._setSelected=function(b,c){var d=h.call(this,b,c),e=this.element,f=parseInt(b.data("optionLink").val(),10);return c&&this.selectedList&&(g.call(this,f),this.selectedList.find("li").each(function(){a(this).data("optionLink")&&a(this).data("optionLink").remove().appendTo(e)})),d}}f.prototype.destroy&&(f.prototype.destroy=function(){var b=this;b.element.show(),b.container.remove(),void 0===a.Widget?a.widget.prototype.destroy.apply(b,arguments):a.Widget.prototype.destroy.apply(b,arguments)}),d._multiselect=!0}d.extend({sortableColumns:function(b){return this.each(function(){function d(){g.disableClick=!0}var f=this,g=f.p,h=e(g.id);if(g&&g.sortable&&a.isFunction(a.fn.sortable)){var i={tolerance:"pointer",axis:"x",scrollSensitivity:"1",items:">th:not(:has(#jqgh_"+h+"_cb,#jqgh_"+h+"_rn,#jqgh_"+h+"_subgrid),:hidden)",placeholder:{element:function(b){return a(c.createElement(b[0].nodeName)).addClass(b[0].className+" ui-sortable-placeholder ui-state-highlight").removeClass("ui-sortable-helper")[0]},update:function(a,b){b.height(a.currentItem.innerHeight()-parseInt(a.currentItem.css("paddingTop")||0,10)-parseInt(a.currentItem.css("paddingBottom")||0,10)),b.width(a.currentItem.innerWidth()-parseInt(a.currentItem.css("paddingLeft")||0,10)-parseInt(a.currentItem.css("paddingRight")||0,10))}},start:function(){f.grid.hDiv.scrollLeft=f.grid.bDiv.scrollLeft},update:function(b,c){var d=a(">th",a(c.item).parent()),e=g.id+"_",h=[];d.each(function(){var b=a(">div",this).get(0).id.replace(/^jqgh_/,"").replace(e,""),c=g.iColByName[b];void 0!==c&&h.push(c)}),a(f).jqGrid("remapColumns",h,!0,!0),a.isFunction(g.sortable.update)&&g.sortable.update(h),setTimeout(function(){g.disableClick=!1},50)}};if(g.sortable.options?a.extend(i,g.sortable.options):a.isFunction(g.sortable)&&(g.sortable={update:g.sortable}),i.start){var j=i.start;i.start=function(a,b){d(),j.call(this,a,b)}}else i.start=d;g.sortable.exclude&&(i.items+=":not("+g.sortable.exclude+")");var k=b.sortable(i),l=k.data("sortable")||k.data("uiSortable")||k.data("ui-sortable");null!=l&&(l.floating=!0)}})},columnChooser:function(c){function h(b,c){b&&("string"==typeof b?a.fn[b]&&a.fn[b].apply(c,a.makeArray(arguments).slice(2)):a.isFunction(b)&&b.apply(c,a.makeArray(arguments).slice(2)))}var i,j,k,l,m,n,o,p=this,q=p[0],r=q.p,s=r.colModel,t=s.length,u=r.colNames,v=function(a){return f&&f.prototype&&a.data(f.prototype.widgetFullName||f.prototype.widgetName)||a.data("ui-multiselect")||a.data("multiselect")};if(!a("#colchooser_"+e(r.id)).length){if(i=a('<div id="colchooser_'+r.id+'" style="position:relative;overflow:hidden"><div><select multiple="multiple"></select></div></div>'),j=a("select",i),c=a.extend({width:400,height:240,classname:null,done:function(a){a&&p.jqGrid("remapColumns",a,!0)},msel:"multiselect",dlog:"dialog",dialog_opts:{minWidth:470,dialogClass:"ui-jqdialog"},dlog_opts:function(b){var c={};return c[b.bSubmit]=function(){b.apply_perm(),b.cleanup(!1)},c[b.bCancel]=function(){b.cleanup(!0)},a.extend(!0,{buttons:c,close:function(){b.cleanup(!0)},modal:b.modal||!1,resizable:b.resizable||!0,width:b.width+70,resize:function(){var a=v(j),b=a.container.closest(".ui-dialog-content");b.length>0&&"object"==typeof b[0].style?b[0].style.width="":b.css("width",""),a.selectedList.height(Math.max(a.selectedContainer.height()-a.selectedActions.outerHeight()-1,1)),a.availableList.height(Math.max(a.availableContainer.height()-a.availableActions.outerHeight()-1,1))}},b.dialog_opts||{})},apply_perm:function(){var b,d,e=new Array(r.colModel.length),f={notSkipFrozen:void 0!==c.notSkipFrozen&&c.notSkipFrozen,skipSetGridWidth:!0,skipSetGroupHeaders:!0};for(b=0;b<r.colModel.length;b++)e[b]=r.iColByName[n.newColOrder[b]];if(a("option",j).each(function(){a(this).is(":selected")?p.jqGrid("showCol",s[this.value].name,f):p.jqGrid("hideCol",s[this.value].name,f)}),c.done&&c.done.call(p,e),r.groupHeader&&("object"==typeof r.groupHeader||a.isFunction(r.groupHeader)))if(p.jqGrid("destroyGroupHeader",!1),r.groupHeader.groupHeaders=n.gh,null!=r.pivotOptions&&null!=r.pivotOptions.colHeaders&&r.pivotOptions.colHeaders.length>1)for(d=r.pivotOptions.colHeaders,b=0;b<d.length;b++)d[b]&&d[b].groupHeaders.length&&p.jqGrid("setGroupHeaders",d[b]);else p.jqGrid("setGroupHeaders",r.groupHeader);var g=r.autowidth||void 0!==r.widthOrg&&"auto"!==r.widthOrg&&"100%"!==r.widthOrg?r.width:r.tblwidth;g!==r.width&&p.jqGrid("setGridWidth",g,r.shrinkToFit)},cleanup:function(a){h(c.dlog,i,"destroy"),h(c.msel,j,"destroy"),i.remove(),a&&c.done&&c.done.call(p)},msel_opts:{}},p.jqGrid("getGridRes","col"),d.col,c||{}),a.ui&&f&&f.defaults){if(!d._multiselect)return void(null!=d.defaults&&a.isFunction(d.defaults.fatalError)?d.defaults.fatalError:alert)("Multiselect plugin loaded after jqGrid. Please load the plugin before the jqGrid!");c.msel_opts=a.extend(f.defaults,c.msel_opts)}c.caption&&i.attr("title",c.caption),c.classname&&(i.addClass(c.classname),j.addClass(c.classname)),c.width&&(a(">div",i).css({width:c.width,margin:"0 auto"}),j.css("width",c.width)),c.height&&(a(">div",i).css("height",c.height),j.css("height",c.height-10)),j.empty();var w,x,y,z,A=null!=r.groupHeader?r.groupHeader.groupHeaders:0,B={};if(A)for(w=0;w<A.length;w++)for(z=A[w],x=0;x<z.numberOfColumns;x++)y=r.iColByName[z.startColumnName]+x,B[y]=a.isFunction(c.buildItemText)?c.buildItemText.call(p[0],{iCol:y,cm:s[y],cmName:s[y].name,colName:u[y],groupTitleText:z.titleText}):a.jgrid.stripHtml(z.titleText)+": "+a.jgrid.stripHtml(""===u[y]?s[y].name:u[y]);for(y=0;y<t;y++)void 0===B[y]&&(B[y]=a.isFunction(c.buildItemText)?c.buildItemText.call(p[0],{iCol:y,cm:s[y],cmName:s[y].name,colName:u[y],groupTitleText:null}):a.jgrid.stripHtml(u[y]));if(a.each(s,function(a){this.hidedlg||j.append("<option value='"+a+"'"+(r.headertitles||this.headerTitle?" title='"+d.stripHtml("string"==typeof this.headerTitle?this.headerTitle:B[a])+"'":"")+(this.hidden?"":" selected='selected'")+">"+B[a]+"</option>")}),k=a.isFunction(c.dlog_opts)?c.dlog_opts.call(p,c):c.dlog_opts,h(c.dlog,i,k),l=a.isFunction(c.msel_opts)?c.msel_opts.call(p,c):c.msel_opts,h(c.msel,j,l),m=a("#colchooser_"+e(r.id)),m.css({margin:"auto"}),m.find(">div").css({width:"100%",height:"100%",margin:"auto"}),n=v(j)){if(n.grid=q,A){n.gh=a.extend(!0,[],A),n.inGroup=new Array(r.colModel.length);var C,D;for(C=0;C<A.length;C++)for(D=A[C],y=0;y<D.numberOfColumns;y++)n.inGroup[r.iColByName[D.startColumnName]+y]=C}n.newColOrder=a.map(s,function(a){return a.name}),n.container.css({width:"100%",height:"100%",margin:"auto"}),n.selectedContainer.css({width:100*n.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),n.availableContainer.css({width:100-100*n.options.dividerLocation+"%",height:"100%",margin:"auto",boxSizing:"border-box"}),n.selectedList.css("height","auto"),n.availableList.css("height","auto"),o=Math.max(n.selectedList.height(),n.availableList.height()),o=Math.min(o,a(b).height()),n.selectedList.css("height",o),n.availableList.css("height",o),null!=n.options&&n.options.sortable&&n.selectedList.on("sortupdate",function(b,d){g.call(n,parseInt(d.item.data("optionLink").val(),10)),d.item.css({width:"",height:""}),a.isFunction(c.sortUpdate)&&c.sortUpdate.call(q,b,d)}),a.isFunction(c.init)&&c.init.call(q,n)}}},sortableRows:function(b){return this.each(function(){var c=this,d=c.grid,e=c.p;d&&(e.treeGrid||a.fn.sortable&&(b=a.extend({cursor:"move",axis:"y",items:">tbody>.jqgrow"},b||{}),b.start&&a.isFunction(b.start)?(b._start_=b.start,delete b.start):b._start_=!1,b.update&&a.isFunction(b.update)?(b._update_=b.update,delete b.update):b._update_=!1,b.start=function(f,g){if(a(g.item).css("border-width","0"),a("td",g.item).each(function(a){this.style.width=d.cols[a].style.width}),e.subGrid){var h=a(g.item).attr("id");try{a(c).jqGrid("collapseSubGridRow",h)}catch(a){}}b._start_&&b._start_.apply(this,[f,g])},b.update=function(d,f){a(f.item).css("border-width",""),e.rownumbers===!0&&a("td.jqgrid-rownum",c.rows).each(function(b){a(this).html(b+1+(parseInt(e.page,10)-1)*parseInt(e.rowNum,10))}),b._update_&&b._update_.apply(this,[d,f])},a(c).sortable(b)))})},gridDnD:function(b){return this.each(function(){function c(){var b=a.data(g,"dnd");a("tr.jqgrow:not(.ui-draggable)",g).draggable(a.isFunction(b.drag)?b.drag.call(a(g),b):b.drag)}var d,f,g=this;if(g.grid&&!g.p.treeGrid&&a.fn.draggable&&a.fn.droppable){if(void 0===a("#jqgrid_dnd")[0]&&a("body").append("<table id='jqgrid_dnd' class='ui-jqgrid-dnd'></table>"),"string"==typeof b&&"updateDnD"===b&&g.p.jqgdnd===!0)return void c();if(b=a.extend({drag:function(b){return a.extend({start:function(c,d){var e,f;if(g.p.subGrid){f=a(d.helper).attr("id");try{a(g).jqGrid("collapseSubGridRow",f)}catch(a){}}for(e=0;e<a.data(g,"dnd").connectWith.length;e++)0===a(a.data(g,"dnd").connectWith[e]).jqGrid("getGridParam","reccount")&&a(a.data(g,"dnd").connectWith[e]).jqGrid("addRowData","jqg_empty_row",{});d.helper.addClass("ui-state-highlight"),a("td",d.helper).each(function(a){this.style.width=g.grid.headers[a].width+"px"}),b.onstart&&a.isFunction(b.onstart)&&b.onstart.call(a(g),c,d)},stop:function(c,d){var e,f;for(d.helper.dropped&&!b.dragcopy&&(f=a(d.helper).attr("id"),void 0===f&&(f=a(this).attr("id")),a(g).jqGrid("delRowData",f)),e=0;e<a.data(g,"dnd").connectWith.length;e++)a(a.data(g,"dnd").connectWith[e]).jqGrid("delRowData","jqg_empty_row");b.onstop&&a.isFunction(b.onstop)&&b.onstop.call(a(g),c,d)}},b.drag_opts||{})},drop:function(b){return a.extend({accept:function(b){if(!a(b).hasClass("jqgrow"))return b;var c=a(b).closest("table.ui-jqgrid-btable");if(c.length>0&&void 0!==a.data(c[0],"dnd")){var d=a.data(c[0],"dnd").connectWith;return a.inArray("#"+e(this.id),d)!==-1}return!1},drop:function(c,d){if(a(d.draggable).hasClass("jqgrow")){var f=a(d.draggable).attr("id"),h=d.draggable.parent().parent().jqGrid("getRowData",f);if(!b.dropbyname){var i,j,k=0,l={},m=a("#"+e(this.id)).jqGrid("getGridParam","colModel");try{for(j in h)h.hasOwnProperty(j)&&(i=m[k].name,"cb"!==i&&"rn"!==i&&"subgrid"!==i&&h.hasOwnProperty(j)&&m[k]&&(l[i]=h[j]),k++);h=l}catch(a){}}if(d.helper.dropped=!0,b.beforedrop&&a.isFunction(b.beforedrop)){var n=b.beforedrop.call(this,c,d,h,a("#"+e(g.p.id)),a(this));void 0!==n&&null!==n&&"object"==typeof n&&(h=n)}if(d.helper.dropped){var o;b.autoid&&(a.isFunction(b.autoid)?o=b.autoid.call(this,h):(o=Math.ceil(1e3*Math.random()),o=b.autoidprefix+o)),a("#"+e(this.id)).jqGrid("addRowData",o,h,b.droppos),h[g.p.localReader.id]=o}b.ondrop&&a.isFunction(b.ondrop)&&b.ondrop.call(this,c,d,h)}}},b.drop_opts||{})},onstart:null,onstop:null,beforedrop:null,ondrop:null,drop_opts:{},drag_opts:{revert:"invalid",helper:"clone",cursor:"move",appendTo:"#jqgrid_dnd",zIndex:5e3},dragcopy:!1,dropbyname:!1,droppos:"first",autoid:!0,autoidprefix:"dnd_"},b||{}),b.connectWith)for(b.connectWith=b.connectWith.split(","),b.connectWith=a.map(b.connectWith,function(b){return a.trim(b)}),a.data(g,"dnd",b),0===g.p.reccount||g.p.jqgdnd||c(),g.p.jqgdnd=!0,d=0;d<b.connectWith.length;d++)f=b.connectWith[d],a(f).droppable(a.isFunction(b.drop)?b.drop.call(a(g),b):b.drop)}})},gridResize:function(b){return this.each(function(){var c,d=this,e=d.grid,f=d.p,g=f.gView+">.ui-jqgrid-bdiv",h=!1,i=f.height;if(e&&a.fn.resizable){if(b=a.extend({},b||{}),b.alsoResize?(b._alsoResize_=b.alsoResize,delete b.alsoResize):b._alsoResize_=!1,b.stop&&a.isFunction(b.stop)?(b._stop_=b.stop,delete b.stop):b._stop_=!1,b.stop=function(j,k){a(d).jqGrid("setGridWidth",k.size.width,b.shrinkToFit),a(f.gView+">.ui-jqgrid-titlebar").css("width",""),h?(a(c).each(function(){a(this).css("height","")}),"auto"!==i&&"100%"!==i||a(e.bDiv).css("height",i)):a(d).jqGrid("setGridParam",{height:a(g).height()}),d.fixScrollOffsetAndhBoxPadding&&d.fixScrollOffsetAndhBoxPadding(),b._stop_&&b._stop_.call(d,j,k)},c=g,"auto"!==i&&"100%"!==i||void 0!==b.handles||(b.handles="e,w"),b.handles){var j=a.map(String(b.handles).split(","),function(b){return a.trim(b)});2===j.length&&("e"===j[0]&&"w"===j[1]||"e"===j[1]&&"w"===j[1])&&(c=f.gView+">div:not(.frozen-div)",h=!0,f.pager&&(c+=","+f.pager))}b._alsoResize_?b.alsoResize=c+","+b._alsoResize_:b.alsoResize=c,delete b._alsoResize_,a(f.gBox).resizable(b)}})}})});
//# sourceMappingURL=grid.jqueryui.js.map