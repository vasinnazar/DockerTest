!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.common"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return b||(b=window),void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),require("./grid.base"),require("./jquery.fmatter"),require("./grid.common"),a(c),c}:a(jQuery)}(function(a){"use strict";var b=a.jgrid,c=b.fullBoolFeedback,d=b.hasOneFromClasses,e=a.fn.jqGrid,f=function(a){return e.getGuiStyles.call(this,"states."+a)},g=function(c){var d=a.makeArray(arguments).slice(1);return d.unshift(""),d.unshift("Inline"),d.unshift(c),b.feedback.apply(this,d)};b.inlineEdit=b.inlineEdit||{},b.extend({editRow:function(d,e,h,i,j,k,l,m,n,o){var p={},q=a.makeArray(arguments).slice(1);return"object"===a.type(q[0])?p=q[0]:(void 0!==e&&(p.keys=e),a.isFunction(h)&&(p.oneditfunc=h),a.isFunction(i)&&(p.successfunc=i),void 0!==j&&(p.url=j),null!=k&&(p.extraparam=k),a.isFunction(l)&&(p.aftersavefunc=l),a.isFunction(m)&&(p.errorfunc=m),a.isFunction(n)&&(p.afterrestorefunc=n),a.isFunction(o)&&(p.beforeEditRow=o)),this.each(function(){var e=this,h=a(e),i=e.p,j=0,k=null,l={},m=i.colModel,n=i.prmNames;if(e.grid){var o=a.extend(!0,{keys:!1,oneditfunc:null,successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,beforeEditRow:null,focusField:!0},b.inlineEdit,i.inlineEditing||{},p),q=h.jqGrid("getInd",d,!0),r=o.focusField,s="object"==typeof r&&null!=r?a(r.target||r).closest("tr.jqgrow>td")[0]:null;if(q!==!1&&(o.extraparam[n.oper]===n.addoper||g.call(e,o,"beforeEditRow",o,d))&&"0"===(a(q).attr("editable")||"0")&&!a(q).hasClass("not-editable-row")){var t=b.detectRowEditing.call(e,d);if(null!=t&&"cellEditing"===t.mode){var u=t.savedRow,v=e.rows[u.id],w=f.call(e,"select");h.jqGrid("restoreCell",u.id,u.ic),a(v.cells[u.ic]).removeClass("edit-cell "+w),a(v).addClass(w).attr({"aria-selected":"true",tabindex:"0"})}if(b.enumEditableCells.call(e,q,a(q).hasClass("jqgrid-new-row")?"add":"edit",function(c){var f,g,h,m=c.cm,n=a(c.dataElement),o=c.dataWidth,p=m.name,q=m.edittype,r=c.iCol,s=m.editoptions||{};if("hidden"!==c.editable){try{f=a.unformat.call(this,c.td,{rowId:d,colModel:m},r)}catch(a){f="textarea"===q?n.text():n.html()}l[p]=f,n.html(""),g=a.extend({},s,{id:d+"_"+p,name:p,rowId:d,mode:c.mode,cm:m,iCol:r}),("&nbsp;"===f||"&#160;"===f||1===f.length&&160===f.charCodeAt(0))&&(f=""),h=b.createEl.call(e,q,g,f,!0,a.extend({},b.ajaxOptions,i.ajaxSelectOptions||{})),a(h).addClass("editable"),n.append(h),o&&a(h).width(c.dataWidth),b.bindEv.call(e,h,g),"select"===q&&s.multiple===!0&&void 0===s.dataUrl&&b.msie&&a(h).width(a(h).width()),null===k&&(k=r),j++}}),j>0){if(l.id=d,i.savedRow.push(l),a(q).attr("editable","1"),r&&("number"==typeof r&&parseInt(r,10)<=m.length?k=r:"string"==typeof r?k=i.iColByName[r]:null!=s&&(k=s.cellIndex),setTimeout(function(){var b=h.jqGrid("getNumberOfFrozenColumns"),c=function(a){return i.frozenColumns&&b>0&&k<b?e.grid.fbRows[q.rowIndex].cells[a]:q.cells[a]},d=function(b){return a(b).find("input,textarea,select,button,object,*[tabindex]").filter(":input:visible:not(:disabled)")},f=function(){return d(i.frozenColumns&&b>0?e.grid.fbRows[q.rowIndex]:q).first()},g=d(c(k));g.length>0?g.first().focus():"number"==typeof o.defaultFocusField||"string"==typeof o.defaultFocusField?(g=d(c("number"==typeof o.defaultFocusField?o.defaultFocusField:i.iColByName[o.defaultFocusField])),0===g.length&&(g=f()),g.first().focus()):f().focus()},0)),o.keys===!0){var x=a(q);i.frozenColumns&&(x=x.add(e.grid.fbRows[q.rowIndex])),x.on("keydown",function(a){if(27===a.keyCode)return h.jqGrid("restoreRow",d,o.afterrestorefunc),!1;if(13===a.keyCode){return"TEXTAREA"===a.target.tagName||(h.jqGrid("saveRow",d,o),!1)}})}c.call(e,o.oneditfunc,"jqGridInlineEditRow",d,o)}}}})},saveRow:function(d,e,h,i,j,k,l,m){var n,o=a.makeArray(arguments).slice(1),p={},q=this[0],r=a(q),s=null!=q?q.p:null,t=b.info_dialog,u=a.isFunction,v=null!=b.defaults&&u(b.defaults.fatalError)?b.defaults.fatalError:alert;if(q.grid&&null!=s){"object"===a.type(o[0])?p=o[0]:(u(e)&&(p.successfunc=e),void 0!==h&&(p.url=h),void 0!==i&&(p.extraparam=i),u(j)&&(p.aftersavefunc=j),u(k)&&(p.errorfunc=k),u(l)&&(p.afterrestorefunc=l),u(m)&&(p.beforeSaveRow=m));var w=function(a){return r.jqGrid("getGridRes",a)};p=a.extend(!0,{successfunc:null,url:null,extraparam:{},aftersavefunc:null,errorfunc:null,afterrestorefunc:null,restoreAfterError:!0,beforeSaveRow:null,ajaxSaveOptions:{},serializeSaveData:null,mtype:"POST",saveui:"enable",savetext:w("defaults.savetext")||"Saving..."},b.inlineEdit,s.inlineEditing||{},p);var x,y,z,A,B,C,D,E,F={},G={},H={},I=r.jqGrid("getInd",d,!0),J=a(I),K=s.prmNames,L=w("errors.errcap"),M=w("edit.bClose"),N=function(c,d){try{var e=b.getRelativeRect.call(q,d);t.call(q,L,c,M,{top:e.top,left:e.left+a(q).closest(".ui-jqgrid").offset().left})}catch(a){v(c)}};if(I!==!1&&(n=p.extraparam[K.oper]===K.addoper?"add":"edit",g.call(q,p,"beforeSaveRow",p,d,n)&&(x=J.attr("editable"),p.url=p.url||s.editurl,D="clientArray"!==p.url,"1"===x))){if(C=(a.jgrid.detectRowEditing.call(q,d)||{}).savedRow,b.enumEditableCells.call(q,I,J.hasClass("jqgrid-new-row")?"add":"edit",function(c){var d=c.cm,e=d.formatter,f=d.editoptions||{},g=d.formatoptions||{},h={},i=b.getEditedValue.call(q,a(c.dataElement),d,h,c.editable);if("select"===d.edittype&&"select"!==d.formatter&&(G[d.name]=h.text),null!=(B=b.checkValues.call(q,i,c.iCol,void 0,void 0,a.extend(c,{oldValue:null!=C?C[d.name]:null,newValue:i,oldRowData:C})))&&B[0]===!1)return E=!0,N(B[1],c.td),!1;"date"===e&&g.sendFormatted!==!0&&(i=a.unformat.date.call(q,i,d)),D&&f.NullIfEmpty===!0&&""===i&&(i="null"),F[d.name]=i}),E)return;var O;K=s.prmNames,O=s.keyName===!1?K.id:s.keyName,F&&(F[K.oper]=K.editoper,void 0!==F[O]&&""!==F[O]||(F[O]=b.stripPref(s.idPrefix,d)),F=a.extend({},F,s.inlineData||{},p.extraparam));var P={options:p,rowid:d,tr:I,iRow:I.rowIndex,savedRow:C,newData:F,mode:n};if(!g.call(q,p,"saveRowValidation",P))return void(P.errorText&&N(P.errorText,I));if(D)r.jqGrid("progressBar",{method:"show",loadtype:p.saveui,htmlcontent:p.savetext}),H=a.extend({},F,H),H[O]=b.stripPref(s.idPrefix,H[O]),s.autoEncodeOnEdit&&a.each(H,function(a,c){u(c)||(H[a]=b.oldEncodePostedData(c))}),I.id===s.idPrefix+H[O]||null==K.idold||H.hasOwnProperty(K.idold)||(H[K.idold]=b.stripPref(s.idPrefix,I.id)),a.ajax(a.extend({url:u(p.url)?p.url.call(q,H[O],n,H,p):p.url,data:b.serializeFeedback.call(q,u(p.serializeSaveData)?p.serializeSaveData:s.serializeRowData,"jqGridInlineSerializeSaveData",H),type:u(p.mtype)?p.mtype.call(q,n,p,H[O],H):p.mtype,complete:function(e,f){if(r.jqGrid("progressBar",{method:"hide",loadtype:p.saveui}),(e.status<300||304===e.status)&&(0!==e.status||4!==e.readyState)){var g,h,i;if(h=r.triggerHandler("jqGridInlineSuccessSaveRow",[e,d,p,n,H]),null!=h&&h!==!0||(h=[!0,F]),h[0]&&u(p.successfunc)&&(h=p.successfunc.call(q,e,d,p,n,H)),a.isArray(h)?(g=h[0],F=h[1]||F):g=h,g===!0){for(s.autoEncodeOnEdit&&a.each(F,function(a,c){F[a]=b.oldDecodePostedData(c)}),F=a.extend({},F,G),r.jqGrid("setRowData",d,F),J.attr("editable","0"),i=0;i<s.savedRow.length;i++)if(String(s.savedRow[i].id)===String(d)){z=i;break}z>=0&&s.savedRow.splice(z,1),c.call(q,p.aftersavefunc,"jqGridInlineAfterSaveRow",d,e,F,p),null!=h[2]?r.jqGrid("changeRowid",d,s.idPrefix+h[2]):I.id!==s.idPrefix+F[O]&&r.jqGrid("changeRowid",I.id,s.idPrefix+F[O]),J.removeClass("jqgrid-new-row").off("keydown")}else c.call(q,p.errorfunc,"jqGridInlineErrorSaveRow",d,e,f,null,p),p.restoreAfterError===!0&&r.jqGrid("restoreRow",d,p.afterrestorefunc)}},error:function(a,b,c){if(r.triggerHandler("jqGridInlineErrorSaveRow",[d,a,b,c,p]),u(p.errorfunc))p.errorfunc.call(q,d,a,b,c);else{var e=a.responseText||a.statusText;try{t.call(q,L,'<div class="'+f.call(q,"error")+'">'+e+"</div>",M,{buttonalign:"right"})}catch(a){v(e)}}p.restoreAfterError===!0&&r.jqGrid("restoreRow",d,p.afterrestorefunc)}},b.ajaxOptions,s.ajaxRowOptions,p.ajaxSaveOptions||{}));else{for(F=a.extend({},F,G),A=r.jqGrid("setRowData",d,F),J.attr("editable","0"),y=0;y<s.savedRow.length;y++)if(String(s.savedRow[y].id)===String(d)){z=y;break}z>=0&&s.savedRow.splice(z,1),c.call(q,p.aftersavefunc,"jqGridInlineAfterSaveRow",d,A,F,p),J.removeClass("jqgrid-new-row").off("keydown"),I.id!==s.idPrefix+F[O]&&r.jqGrid("changeRowid",I.id,s.idPrefix+F[O])}}}},restoreRow:function(d,e){var f=a.makeArray(arguments).slice(1),h={};return"object"===a.type(f[0])?h=f[0]:a.isFunction(e)&&(h.afterrestorefunc=e),this.each(function(){var e,f=this,i=a(f),j=f.p,k=-1,l={};if(f.grid){var m=a.extend(!0,{},b.inlineEdit,j.inlineEditing||{},h),n=i.jqGrid("getInd",d,!0);if(n!==!1&&g.call(f,m,"beforeCancelRow",m,d)){for(e=0;e<j.savedRow.length;e++)if(String(j.savedRow[e].id)===String(d)){k=e;break}if(k>=0){if(a.isFunction(a.fn.datepicker))try{a("input.hasDatepicker","#"+b.jqID(n.id)).datepicker("hide")}catch(a){}a.each(j.colModel,function(){var b=this.name;j.savedRow[k].hasOwnProperty(b)&&(l[b]=j.savedRow[k][b],!this.formatter||"date"!==this.formatter||null!=this.formatoptions&&this.formatoptions.sendFormatted===!0||(l[b]=a.unformat.date.call(f,l[b],this)))}),i.jqGrid("setRowData",d,l),a(n).attr("editable","0").off("keydown"),j.savedRow.splice(k,1),a("#"+b.jqID(d),f).hasClass("jqgrid-new-row")&&setTimeout(function(){i.jqGrid("delRowData",d),i.jqGrid("showAddEditButtons",!1)},0)}c.call(f,m.afterrestorefunc,"jqGridInlineAfterRestoreRow",d)}}})},addRow:function(c){return this.each(function(){if(this.grid){var d=this,e=a(d),f=d.p,h=a.extend(!0,{rowID:null,initdata:{},position:"first",useDefValues:!0,useFormatter:!1,beforeAddRow:null,addRowParams:{extraparam:{}}},b.inlineEdit,f.inlineEditing||{},c||{});if(g.call(d,h,"beforeAddRow",h.addRowParams))if(h.rowID=a.isFunction(h.rowID)?h.rowID.call(d,h):null!=h.rowID?h.rowID:b.randId(),h.useDefValues===!0&&a(f.colModel).each(function(){if(this.editoptions&&this.editoptions.defaultValue){var b=this.editoptions.defaultValue;h.initdata[this.name]=a.isFunction(b)?b.call(d):b}}),h.rowID=f.idPrefix+h.rowID,e.jqGrid("addRowData",h.rowID,h.initdata,h.position),a("#"+b.jqID(h.rowID),d).addClass("jqgrid-new-row"),h.useFormatter)a("#"+b.jqID(h.rowID)+" .ui-inline-edit",d).click();else{var i=f.prmNames,j=i.oper;h.addRowParams.extraparam[j]=i.addoper,e.jqGrid("editRow",h.rowID,h.addRowParams),e.jqGrid("setSelection",h.rowID)}}})},inlineNav:function(c,e){return"object"==typeof c&&(e=c,c=void 0),this.each(function(){var g=this,h=a(g),i=g.p;if(this.grid&&null!=i){var j,k=c===i.toppager?i.idSel+"_top":i.idSel,l=c===i.toppager?i.id+"_top":i.id,m=f.call(g,"disabled"),n=a.extend(!0,{edit:!0,editicon:"ui-icon-pencil",add:!0,addicon:"ui-icon-plus",save:!0,saveicon:"ui-icon-disk",cancel:!0,cancelicon:"ui-icon-cancel",commonIconClass:"ui-icon",iconsOverText:!1,addParams:{addRowParams:{extraparam:{}}},editParams:{},restoreAfterSelect:!0},h.jqGrid("getGridRes","nav"),b.nav||{},i.navOptions||{},b.inlineNav||{},i.inlineNavOptions||{},e||{}),o=function(){g.modalAlert()};if(void 0===c)if(i.pager){if(h.jqGrid("inlineNav",i.pager,n),!i.toppager)return;c=i.toppager,k=i.idSel+"_top",l=i.id+"_top"}else i.toppager&&(c=i.toppager,k=i.idSel+"_top",l=i.id+"_top");if(void 0!==c&&(j=a(c),!(j.length<=0))){if(j.find(".navtable").length<=0&&h.jqGrid("navGrid",c,{add:!1,edit:!1,del:!1,search:!1,refresh:!1,view:!1}),i._inlinenav=!0,n.addParams.useFormatter===!0){var p,q,r,s=i.colModel;for(p=0;p<s.length;p++)if(s[p].formatter&&"actions"===s[p].formatter){s[p].formatoptions&&(q={keys:!1,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},r=a.extend(q,s[p].formatoptions),n.addParams.addRowParams={keys:r.keys,oneditfunc:r.onEdit,successfunc:r.onSuccess,url:r.url,extraparam:r.extraparam,aftersavefunc:r.afterSave,errorfunc:r.onError,afterrestorefunc:r.afterRestore});break}}n.add&&h.jqGrid("navButtonAdd",c,{caption:n.addtext,title:n.addtitle,commonIconClass:n.commonIconClass,buttonicon:n.addicon,iconsOverText:n.iconsOverText,id:l+"_iladd",onClickButton:function(){d(this,m)||h.jqGrid("addRow",n.addParams)}}),n.edit&&h.jqGrid("navButtonAdd",c,{caption:n.edittext,title:n.edittitle,commonIconClass:n.commonIconClass,buttonicon:n.editicon,iconsOverText:n.iconsOverText,id:l+"_iledit",onClickButton:function(){if(!d(this,m)){var a=i.selrow;a?h.jqGrid("editRow",a,n.editParams):o()}}}),n.save&&(h.jqGrid("navButtonAdd",c,{caption:n.savetext,title:n.savetitle,commonIconClass:n.commonIconClass,buttonicon:n.saveicon,iconsOverText:n.iconsOverText,id:l+"_ilsave",onClickButton:function(){if(!d(this,m)){var c=i.savedRow[0].id;if(c){var e=i.prmNames,f=e.oper,j=n.editParams;a("#"+b.jqID(c),g).hasClass("jqgrid-new-row")?(n.addParams.addRowParams.extraparam[f]=e.addoper,j=n.addParams.addRowParams):(n.editParams.extraparam||(n.editParams.extraparam={}),n.editParams.extraparam[f]=e.editoper),h.jqGrid("saveRow",c,j)}else o()}}}),a(k+"_ilsave").addClass(m)),n.cancel&&(h.jqGrid("navButtonAdd",c,{caption:n.canceltext,title:n.canceltitle,commonIconClass:n.commonIconClass,buttonicon:n.cancelicon,iconsOverText:n.iconsOverText,id:l+"_ilcancel",onClickButton:function(){if(!d(this,m)){var c=i.savedRow[0].id,e=n.editParams;c?(a("#"+b.jqID(c),g).hasClass("jqgrid-new-row")&&(e=n.addParams.addRowParams),h.jqGrid("restoreRow",c,e)):o()}}}),a(k+"_ilcancel").addClass(m)),n.restoreAfterSelect===!0&&h.on("jqGridSelectRow",function(a,b){if(i.savedRow.length>0&&i._inlinenav===!0){var c=i.savedRow[0].id;b!==c&&"number"!=typeof c&&h.jqGrid("restoreRow",c,n.editParams)}}),h.on("jqGridInlineAfterRestoreRow jqGridInlineAfterSaveRow",function(){h.jqGrid("showAddEditButtons",!1)}),h.on("jqGridInlineEditRow",function(a,b){h.jqGrid("showAddEditButtons",!0,b)})}}})},showAddEditButtons:function(b){return this.each(function(){var c=this;if(c.grid){var d=c.p,e=d.idSel,g=f.call(c,"disabled"),h=e+"_ilsave,"+e+"_ilcancel"+(d.toppager?","+e+"_top_ilsave,"+e+"_top_ilcancel":""),i=e+"_iladd,"+e+"_iledit"+(d.toppager?","+e+"_top_iladd,"+e+"_top_iledit":"");a(b?i:h).addClass(g),a(b?h:i).removeClass(g)}})}})});
//# sourceMappingURL=grid.inlinedit.js.map